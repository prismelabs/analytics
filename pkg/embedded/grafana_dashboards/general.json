{
	"annotations": {
		"list": [
			{
				"builtIn": 1,
				"datasource": {
					"type": "grafana",
					"uid": "-- Grafana --"
				},
				"enable": true,
				"hide": true,
				"iconColor": "rgba(0, 211, 255, 1)",
				"name": "Annotations & Alerts",
				"type": "dashboard"
			}
		]
	},
	"editable": false,
	"fiscalYearStartMonth": 0,
	"graphTooltip": 0,
	"links": [],
	"liveNow": false,
	"panels": [
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"description": "",
			"fieldConfig": {
				"defaults": {
					"color": {
						"mode": "thresholds"
					},
					"fieldMinMax": true,
					"mappings": [],
					"noValue": "0",
					"thresholds": {
						"mode": "absolute",
						"steps": [
							{
								"color": "purple",
								"value": null
							}
						]
					},
					"unit": "none",
					"unitScale": false
				},
				"overrides": [
					{
						"matcher": {
							"id": "byName",
							"options": "Page views over time Page views over time"
						},
						"properties": [
							{
								"id": "displayName",
								"value": "Total page views"
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "Total page views change"
						},
						"properties": [
							{
								"id": "thresholds",
								"value": {
									"mode": "absolute",
									"steps": [
										{
											"color": "red",
											"value": null
										},
										{
											"color": "#EAB839",
											"value": -5
										},
										{
											"color": "blue",
											"value": 5
										}
									]
								}
							},
							{
								"id": "unit",
								"value": "percent"
							},
							{
								"id": "displayName",
								"value": "Change"
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "Total visits change"
						},
						"properties": [
							{
								"id": "unit",
								"value": "percent"
							},
							{
								"id": "thresholds",
								"value": {
									"mode": "absolute",
									"steps": [
										{
											"color": "red",
											"value": null
										},
										{
											"color": "#EAB839",
											"value": -5
										},
										{
											"color": "blue",
											"value": 5
										}
									]
								}
							},
							{
								"id": "displayName",
								"value": "Change"
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "Views per visit change"
						},
						"properties": [
							{
								"id": "unit",
								"value": "percent"
							},
							{
								"id": "displayName",
								"value": "Change"
							},
							{
								"id": "thresholds",
								"value": {
									"mode": "absolute",
									"steps": [
										{
											"color": "red",
											"value": null
										},
										{
											"color": "yellow",
											"value": -5
										},
										{
											"color": "blue",
											"value": 5
										}
									]
								}
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "Visits over time Visits over time"
						},
						"properties": [
							{
								"id": "displayName",
								"value": "Total visits"
							}
						]
					}
				]
			},
			"gridPos": {
				"h": 7,
				"w": 22,
				"x": 1,
				"y": 0
			},
			"id": 10,
			"options": {
				"colorMode": "background",
				"graphMode": "area",
				"justifyMode": "center",
				"orientation": "auto",
				"reduceOptions": {
					"calcs": [
						"sum"
					],
					"fields": "",
					"values": false
				},
				"showPercentChange": false,
				"textMode": "auto",
				"wideLayout": true
			},
			"pluginVersion": "10.3.3",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": true,
					"meta": {
						"builderOptions": {
							"aggregates": [],
							"columns": [],
							"database": "",
							"filters": [
								{
									"key": "timestamp",
									"operator": "WITH IN DASHBOARD TIME RANGE",
									"type": "datetime"
								}
							],
							"limit": 100,
							"mode": "trend",
							"queryType": "table",
							"table": "events_pageviews"
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT COUNT(*) AS pageviews\nFROM \"prisme\".\"events_pageviews\"\nWHERE timestamp >= fromUnixTimestamp(toUnixTimestamp($__fromTime) - (toUnixTimestamp($__toTime) - toUnixTimestamp($__fromTime)))\nAND timestamp <= $__fromTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\n",
					"refId": "Total page views previous period"
				},
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": false,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 100,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT $__timeInterval(timestamp) as time, COUNT(*) as pageviews\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY time\nORDER BY time",
					"refId": "Page views over time"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "Page views over time",
					"hide": true,
					"reducer": "sum",
					"refId": "Total page views",
					"settings": {
						"mode": "dropNN"
					},
					"type": "reduce"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "100 * (${Total page views} / ${Total page views previous period}) - 100",
					"hide": false,
					"refId": "Total page views change",
					"type": "math"
				},
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": true,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 1000,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT COUNT(*) AS \"Total visits previous period\"\nFROM \"prisme\".\"events_pageviews\"\nWHERE timestamp >= fromUnixTimestamp(toUnixTimestamp($__fromTime) - (toUnixTimestamp($__toTime) - toUnixTimestamp($__fromTime)))\nAND timestamp <= $__fromTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND referrer_domain != domain\nAND country_code IN (${locations:sqlstring})\n",
					"refId": "Total visits previous period"
				},
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": false,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 1000,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT $__timeInterval(timestamp) as time, COUNT(*) AS \"Total visits\"\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND referrer_domain != domain\nAND country_code IN (${locations:sqlstring})\nGROUP BY time\nORDER BY time\n",
					"refId": "Visits over time"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "Visits over time",
					"hide": true,
					"reducer": "sum",
					"refId": "Total visits",
					"type": "reduce"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "(${Total visits} / ${Total visits previous period} - 1) * 100",
					"hide": false,
					"refId": "Total visits change",
					"type": "math"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "${Total page views} / ${Total visits}",
					"hide": false,
					"refId": "Views per visit",
					"type": "math"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "${Total page views previous period} / ${Total visits previous period}",
					"hide": true,
					"refId": "Views per visit previous period",
					"type": "math"
				},
				{
					"datasource": {
						"name": "Expression",
						"type": "__expr__",
						"uid": "__expr__"
					},
					"expression": "(${Views per visit} / ${Views per visit previous period} - 1) * 100",
					"hide": false,
					"refId": "Views per visit change",
					"type": "math"
				}
			],
			"title": "Summary",
			"transparent": true,
			"type": "stat"
		},
		{
			"datasource": {
				"type": "datasource",
				"uid": "-- Dashboard --"
			},
			"description": "Number of page views over time.",
			"fieldConfig": {
				"defaults": {
					"color": {
						"fixedColor": "blue",
						"mode": "palette-classic",
						"seriesBy": "max"
					},
					"custom": {
						"axisBorderShow": false,
						"axisCenteredZero": false,
						"axisColorMode": "text",
						"axisLabel": "",
						"axisPlacement": "auto",
						"barAlignment": 0,
						"drawStyle": "line",
						"fillOpacity": 100,
						"gradientMode": "opacity",
						"hideFrom": {
							"legend": false,
							"tooltip": false,
							"viz": false
						},
						"insertNulls": false,
						"lineInterpolation": "linear",
						"lineStyle": {
							"fill": "solid"
						},
						"lineWidth": 1,
						"pointSize": 5,
						"scaleDistribution": {
							"type": "linear"
						},
						"showPoints": "always",
						"spanNulls": false,
						"stacking": {
							"group": "A",
							"mode": "none"
						},
						"thresholdsStyle": {
							"mode": "off"
						}
					},
					"fieldMinMax": true,
					"mappings": [],
					"noValue": "No data to display. Adjust filters or visit your website to generate your first page view event.",
					"thresholds": {
						"mode": "percentage",
						"steps": [
							{
								"color": "purple",
								"value": null
							}
						]
					},
					"unit": "none",
					"unitScale": false
				},
				"overrides": [
					{
						"matcher": {
							"id": "byName",
							"options": "Page views over time Page views over time"
						},
						"properties": [
							{
								"id": "displayName",
								"value": "Page views"
							},
							{
								"id": "color",
								"value": {
									"fixedColor": "blue",
									"mode": "fixed"
								}
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "Visits over time Visits over time"
						},
						"properties": [
							{
								"id": "displayName",
								"value": "Visits"
							},
							{
								"id": "color",
								"value": {
									"fixedColor": "purple",
									"mode": "fixed"
								}
							}
						]
					}
				]
			},
			"gridPos": {
				"h": 12,
				"w": 22,
				"x": 1,
				"y": 7
			},
			"id": 6,
			"options": {
				"legend": {
					"calcs": [],
					"displayMode": "list",
					"placement": "bottom",
					"showLegend": true
				},
				"tooltip": {
					"mode": "multi",
					"sort": "asc"
				}
			},
			"targets": [
				{
					"datasource": {
						"type": "datasource",
						"uid": "-- Dashboard --"
					},
					"panelId": 10,
					"refId": "A"
				}
			],
			"title": "Time Series",
			"transformations": [],
			"type": "timeseries"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"description": "Top 10 of traffic sources.",
			"fieldConfig": {
				"defaults": {
					"color": {
						"mode": "continuous-BlPu"
					},
					"displayName": "${__field.labels[\"referrer_domain\"]}",
					"fieldMinMax": false,
					"mappings": [],
					"thresholds": {
						"mode": "percentage",
						"steps": [
							{
								"color": "super-light-blue",
								"value": null
							}
						]
					},
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 8,
				"x": 1,
				"y": 19
			},
			"id": 13,
			"options": {
				"displayMode": "lcd",
				"maxVizHeight": 41,
				"minVizHeight": 25,
				"minVizWidth": 8,
				"namePlacement": "auto",
				"orientation": "horizontal",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "",
					"limit": 10,
					"values": true
				},
				"showUnfilled": true,
				"sizing": "manual",
				"valueMode": "text"
			},
			"pluginVersion": "10.3.3",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 100,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT referrer_domain, COUNT(*) as count\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY referrer_domain\nORDER BY count DESC",
					"refId": "A"
				}
			],
			"title": "Top Sources",
			"transformations": [
				{
					"id": "rowsToFields",
					"options": {
						"mappings": [
							{
								"fieldName": "referrer_domain",
								"handlerKey": "field.name"
							},
							{
								"fieldName": "count",
								"handlerKey": "field.value"
							}
						]
					}
				}
			],
			"type": "bargauge"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"fieldConfig": {
				"defaults": {
					"color": {
						"fixedColor": "purple",
						"mode": "shades"
					},
					"custom": {
						"hideFrom": {
							"legend": false,
							"tooltip": false,
							"viz": false
						}
					},
					"mappings": [],
					"unitScale": true
				},
				"overrides": [
					{
						"matcher": {
							"id": "byName",
							"options": "internal Internal"
						},
						"properties": [
							{
								"id": "color",
								"value": {
									"fixedColor": "semi-dark-blue",
									"mode": "fixed"
								}
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "direct Direct"
						},
						"properties": [
							{
								"id": "color",
								"value": {
									"fixedColor": "#7253cf",
									"mode": "fixed"
								}
							}
						]
					},
					{
						"matcher": {
							"id": "byName",
							"options": "External"
						},
						"properties": [
							{
								"id": "color",
								"value": {
									"fixedColor": "semi-dark-purple",
									"mode": "fixed"
								}
							}
						]
					},
					{
						"__systemRef": "hideSeriesFrom",
						"matcher": {
							"id": "byNames",
							"options": {
								"mode": "exclude",
								"names": [
									"internal Internal",
									"direct Direct",
									"external External",
									"Direct"
								],
								"prefix": "All except:",
								"readOnly": true
							}
						},
						"properties": [
							{
								"id": "custom.hideFrom",
								"value": {
									"legend": false,
									"tooltip": false,
									"viz": true
								}
							}
						]
					}
				]
			},
			"gridPos": {
				"h": 13,
				"w": 7,
				"x": 9,
				"y": 19
			},
			"id": 19,
			"options": {
				"displayLabels": [
					"percent",
					"name"
				],
				"legend": {
					"displayMode": "list",
					"placement": "bottom",
					"showLegend": true,
					"values": []
				},
				"pieType": "pie",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "",
					"values": true
				},
				"tooltip": {
					"mode": "single",
					"sort": "none"
				}
			},
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 1000,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT COUNT() AS Internal\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND referrer_domain = domain\nAND country_code IN (${locations:sqlstring})",
					"refId": "internal"
				},
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": false,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 1000,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT COUNT(*) AS Direct\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND referrer_domain = 'direct'\nAND country_code IN (${locations:sqlstring})",
					"refId": "direct"
				},
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"hide": false,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 1000,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.3",
					"queryType": "table",
					"rawSql": "SELECT COUNT(*) AS External\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND referrer_domain != 'direct' AND referrer_domain != domain\nAND country_code IN (${locations:sqlstring})",
					"refId": "external"
				}
			],
			"title": "Traffic Sources",
			"type": "piechart"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"description": "Top 10 of most visited pages.",
			"fieldConfig": {
				"defaults": {
					"color": {
						"mode": "continuous-BlPu"
					},
					"displayName": "${__field.labels[\"path\"]}",
					"mappings": [],
					"thresholds": {
						"mode": "absolute",
						"steps": [
							{
								"color": "green",
								"value": null
							},
							{
								"color": "red",
								"value": 80
							}
						]
					},
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 7,
				"x": 16,
				"y": 19
			},
			"id": 14,
			"options": {
				"displayMode": "lcd",
				"maxVizHeight": 41,
				"minVizHeight": 25,
				"minVizWidth": 8,
				"namePlacement": "top",
				"orientation": "horizontal",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "",
					"limit": 10,
					"values": true
				},
				"showUnfilled": true,
				"sizing": "manual",
				"valueMode": "color"
			},
			"pluginVersion": "10.3.3",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 100,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT path, COUNT(*) as pageviews\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY path\nORDER BY pageviews DESC",
					"refId": "A"
				}
			],
			"title": "Top Pages",
			"transformations": [
				{
					"id": "rowsToFields",
					"options": {
						"mappings": [
							{
								"fieldName": "path",
								"handlerKey": "field.name"
							},
							{
								"fieldName": "pageviews",
								"handlerKey": "field.value"
							}
						]
					}
				}
			],
			"type": "bargauge"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"description": "",
			"fieldConfig": {
				"defaults": {
					"color": {
						"mode": "palette-classic"
					},
					"custom": {
						"hideFrom": {
							"legend": false,
							"tooltip": false,
							"viz": false
						}
					},
					"mappings": [],
					"min": 0,
					"thresholds": {
						"mode": "absolute",
						"steps": [
							{
								"color": "blue",
								"value": null
							}
						]
					},
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 15,
				"x": 1,
				"y": 32
			},
			"id": 15,
			"options": {
				"basemap": {
					"config": {},
					"name": "Layer 0",
					"type": "default"
				},
				"controls": {
					"mouseWheelZoom": false,
					"showAttribution": true,
					"showDebug": false,
					"showMeasure": false,
					"showScale": false,
					"showZoom": true
				},
				"layers": [
					{
						"config": {
							"showLegend": false,
							"style": {
								"color": {
									"fixed": "light-blue"
								},
								"opacity": 0.5,
								"rotation": {
									"fixed": 0,
									"max": 360,
									"min": -360,
									"mode": "mod"
								},
								"size": {
									"field": "pageview",
									"fixed": 5,
									"max": 15,
									"min": 3
								},
								"symbol": {
									"fixed": "img/icons/marker/triangle.svg",
									"mode": "fixed"
								},
								"symbolAlign": {
									"horizontal": "center",
									"vertical": "center"
								},
								"text": {
									"field": "pageview",
									"fixed": "",
									"mode": "fixed"
								},
								"textConfig": {
									"fontSize": 10,
									"offsetX": 0,
									"offsetY": 0,
									"textAlign": "center",
									"textBaseline": "middle"
								}
							}
						},
						"filterData": {
							"id": "byRefId",
							"options": "A"
						},
						"location": {
							"gazetteer": "public/gazetteer/countries.json",
							"lookup": "country_code",
							"mode": "lookup"
						},
						"name": "Layer 1",
						"opacity": 1,
						"tooltip": true,
						"type": "markers"
					}
				],
				"tooltip": {
					"mode": "details"
				},
				"view": {
					"allLayers": true,
					"id": "fit",
					"lat": 0,
					"lon": 0,
					"zoom": 10
				}
			},
			"pluginVersion": "10.3.3",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 100,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT country_code, COUNT(*) as pageview\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY country_code\nORDER BY country_code",
					"refId": "A"
				}
			],
			"transparent": true,
			"type": "geomap"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"description": "Top 10 of visitors' locations.",
			"fieldConfig": {
				"defaults": {
					"color": {
						"mode": "continuous-BlPu"
					},
					"displayName": "${__field.labels[\"country_code\"]}",
					"mappings": [],
					"thresholds": {
						"mode": "absolute",
						"steps": [
							{
								"color": "red",
								"value": null
							},
							{
								"color": "green",
								"value": 0
							}
						]
					},
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 7,
				"x": 16,
				"y": 32
			},
			"id": 18,
			"options": {
				"displayMode": "lcd",
				"maxVizHeight": 41,
				"minVizHeight": 16,
				"minVizWidth": 8,
				"namePlacement": "auto",
				"orientation": "horizontal",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "",
					"limit": 10,
					"values": true
				},
				"showUnfilled": true,
				"sizing": "manual",
				"valueMode": "color"
			},
			"pluginVersion": "10.3.3",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "",
							"limit": 100,
							"mode": "list",
							"queryType": "table",
							"table": ""
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT DISTINCT(country_code), COUNT(*) as pageview\nFROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY country_code\nORDER BY pageview DESC",
					"refId": "A"
				}
			],
			"title": "Top Locations",
			"transformations": [
				{
					"id": "rowsToFields",
					"options": {
						"mappings": [
							{
								"fieldName": "country_code",
								"handlerKey": "field.name"
							},
							{
								"fieldName": "pageview",
								"handlerKey": "field.value"
							}
						]
					}
				},
				{
					"id": "organize",
					"options": {
						"excludeByName": {
							"FR": false
						},
						"includeByName": {},
						"indexByName": {},
						"renameByName": {
							"XX": "Unknown"
						}
					}
				}
			],
			"type": "bargauge"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"fieldConfig": {
				"defaults": {
					"color": {
						"fixedColor": "blue",
						"mode": "shades"
					},
					"custom": {
						"hideFrom": {
							"legend": false,
							"tooltip": false,
							"viz": false
						}
					},
					"displayName": "${__field.labels[\"browser_family\"]}",
					"fieldMinMax": false,
					"mappings": [],
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 11,
				"x": 1,
				"y": 45
			},
			"id": 4,
			"options": {
				"displayLabels": [
					"percent",
					"name"
				],
				"legend": {
					"displayMode": "list",
					"placement": "bottom",
					"showLegend": true,
					"values": []
				},
				"pieType": "pie",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "/^count$/",
					"values": true
				},
				"tooltip": {
					"mode": "single",
					"sort": "none"
				}
			},
			"pluginVersion": "10.2.2",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"aggregates": [],
							"columns": [
								{
									"hint": "time",
									"name": "timestamp",
									"type": "DateTime('UTC')"
								}
							],
							"database": "prisme",
							"filters": [
								{
									"condition": "AND",
									"filterType": "custom",
									"hint": "time",
									"key": "timestamp",
									"operator": "WITH IN DASHBOARD TIME RANGE",
									"restrictToFields": [
										{
											"label": "timestamp",
											"name": "timestamp",
											"picklistValues": [],
											"type": "DateTime('UTC')"
										}
									],
									"type": "datetime"
								}
							],
							"limit": 100,
							"mode": "trend",
							"orderBy": [],
							"queryType": "timeseries",
							"table": "events_pageviews"
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT replaceRegexpAll(browser_family, '(.*) (Mobile|iOS)|Mobile (.*)', '\\\\1\\\\2') AS browser_family, COUNT(browser_family) as count FROM \"prisme\".\"events_pageviews\"\nWHERE $__timeFilter(timestamp)\nAND timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY browser_family",
					"refId": "A"
				}
			],
			"title": "Browsers",
			"transformations": [],
			"type": "piechart"
		},
		{
			"datasource": {
				"type": "grafana-clickhouse-datasource",
				"uid": "{{ .DatasourceClickhouseUid }}"
			},
			"fieldConfig": {
				"defaults": {
					"color": {
						"fixedColor": "purple",
						"mode": "shades"
					},
					"custom": {
						"hideFrom": {
							"legend": false,
							"tooltip": false,
							"viz": false
						}
					},
					"mappings": [],
					"unitScale": true
				},
				"overrides": []
			},
			"gridPos": {
				"h": 13,
				"w": 11,
				"x": 12,
				"y": 45
			},
			"id": 5,
			"options": {
				"displayLabels": [
					"percent",
					"name"
				],
				"legend": {
					"displayMode": "list",
					"placement": "bottom",
					"showLegend": true
				},
				"pieType": "pie",
				"reduceOptions": {
					"calcs": [
						"lastNotNull"
					],
					"fields": "",
					"values": false
				},
				"tooltip": {
					"mode": "single",
					"sort": "none"
				}
			},
			"pluginVersion": "10.2.2",
			"targets": [
				{
					"datasource": {
						"type": "grafana-clickhouse-datasource",
						"uid": "{{ .DatasourceClickhouseUid }}"
					},
					"editorType": "sql",
					"format": 1,
					"meta": {
						"builderOptions": {
							"columns": [],
							"database": "prisme",
							"filters": [
								{
									"condition": "AND",
									"filterType": "custom",
									"key": "timestamp",
									"operator": "WITH IN DASHBOARD TIME RANGE",
									"restrictToFields": [
										{
											"label": "timestamp",
											"name": "timestamp",
											"picklistValues": [],
											"type": "DateTime('UTC')"
										}
									],
									"type": "datetime"
								}
							],
							"limit": 100,
							"mode": "list",
							"orderBy": [],
							"queryType": "table",
							"table": "events_pageviews"
						}
					},
					"pluginVersion": "4.0.0-beta",
					"queryType": "table",
					"rawSql": "SELECT operating_system, COUNT(operating_system) as count\nFROM \"prisme\".\"events_pageviews\" WHERE timestamp >= $__fromTime\nAND timestamp <= $__toTime\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\nAND country_code IN (${locations:sqlstring})\nGROUP BY operating_system",
					"refId": "A"
				}
			],
			"title": "Operating Systems (OS)",
			"transformations": [
				{
					"id": "partitionByValues",
					"options": {
						"fields": [
							"operating_system"
						],
						"naming": {
							"asLabels": true
						}
					}
				},
				{
					"id": "renameByRegex",
					"options": {
						"regex": "count (.*)",
						"renamePattern": "$1"
					}
				}
			],
			"type": "piechart"
		}
	],
	"refresh": "",
	"schemaVersion": 39,
	"tags": [],
	"templating": {
		"list": [
			{
				"current": {
					"selected": false,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(domain) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)",
				"description": "Website domain",
				"hide": 0,
				"includeAll": true,
				"label": "Domain",
				"multi": true,
				"name": "domains",
				"options": [],
				"query": "SELECT DISTINCT(domain) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 1,
				"type": "query"
			},
			{
				"current": {
					"selected": false,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(path) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})",
				"description": "URL path names",
				"hide": 0,
				"includeAll": true,
				"label": "Path",
				"multi": true,
				"name": "pathnames",
				"options": [],
				"query": "SELECT DISTINCT(path) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 1,
				"type": "query"
			},
			{
				"current": {
					"selected": false,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(operating_system) FROM prisme.events_pageviews WHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\n\n",
				"description": "Visitors operating systems",
				"hide": 0,
				"includeAll": true,
				"label": "Operating Systems (OS)",
				"multi": true,
				"name": "operating_systems",
				"options": [],
				"query": "SELECT DISTINCT(operating_system) FROM prisme.events_pageviews WHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\n\n",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 1,
				"type": "query"
			},
			{
				"current": {
					"selected": false,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(browser_family) FROM prisme.events_pageviews WHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\n",
				"description": "Visitors browsers",
				"hide": 0,
				"includeAll": true,
				"label": "Browsers",
				"multi": true,
				"name": "browsers",
				"options": [],
				"query": "SELECT DISTINCT(browser_family) FROM prisme.events_pageviews WHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\n",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 1,
				"type": "query"
			},
			{
				"current": {
					"selected": true,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(referrer_domain) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\n",
				"hide": 0,
				"includeAll": true,
				"label": "Referrals",
				"multi": true,
				"name": "referrals",
				"options": [],
				"query": "SELECT DISTINCT(referrer_domain) FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\n",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 0,
				"type": "query"
			},
			{
				"current": {
					"selected": true,
					"text": [
						"All"
					],
					"value": [
						"$__all"
					]
				},
				"datasource": {
					"type": "grafana-clickhouse-datasource",
					"uid": "{{ .DatasourceClickhouseUid }}"
				},
				"definition": "SELECT DISTINCT(country_code) as country_code FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\n",
				"hide": 0,
				"includeAll": true,
				"label": "Location",
				"multi": true,
				"name": "locations",
				"options": [],
				"query": "SELECT DISTINCT(country_code) as country_code FROM prisme.events_pageviews\nWHERE $__timeFilter(timestamp)\nAND domain IN (${domains:sqlstring})\nAND path IN (${pathnames:sqlstring})\nAND operating_system IN (${operating_systems:sqlstring})\nAND browser_family IN (${browsers:sqlstring})\nAND referrer_domain IN (${referrals:sqlstring})\n",
				"refresh": 2,
				"regex": "",
				"skipUrlSync": false,
				"sort": 1,
				"type": "query"
			}
		]
	},
	"time": {
		"from": "now-2d",
		"to": "now"
	},
	"timepicker": {
		"refresh_intervals": [
			"5m",
			"15m",
			"30m",
			"1h",
			"2h",
			"1d"
		]
	},
	"timezone": "",
	"title": "General",
	"weekStart": ""
}
